<!DOCTYPE html>
<html>
   <head>
      <!-- meta tags-->
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

      <!-- source -->
      <link rel="stylesheet" type="text/css" href="src/vendor/css/fonts.css" />
      <link rel="stylesheet" type="text/css" href="src/vendor/css/font-awesome.css" />

      <link rel="stylesheet" type="text/css" href="src/styles/market.css" />

   </head>
   <body>
      <div id="market">
      
         <div class="shop">
            <div class="header">
               <small> Prodavnica </small>
               <h2> {{ business.name }} </h2>
               <i v-on:click="Close()" class="close fa fa-times"></i>
            </div>

            <div class="content">
               <ul class="products">
                  <li class="product" v-for="(product, i) in business.products" v-on:click="Add(i, product.multiplier)"> 

                  </li>
               </ul>

               <div class="cart">               
                  <h2 class="title"> Vaša korpa - <b> {{ ItemsNumber() }} </b> </h2>
                  <transition-group name="slide" tag="ul" class="items" v-if="player.cart.length > 0">
                     <li class="item" v-for="(item, i) in player.cart" v-bind:key="item"> 
                        <h4> {{ truncate(item.name, 16) }} </h4>
                        <div class="info">
                           <button v-on:click="Remove(item, i)" class="minus"> <i class="fa fa-minus" aria-hidden="true"></i> </button>
                           <h3> {{ item.quantity }} </h3>
                           <button v-on:click="item.quantity ++" class="plus"> <i class="fa fa-plus" aria-hidden="true"></i> </button>
                           <button v-on:click="RemoveAll(i)" class="trash"> <i class="fa fa-trash" aria-hidden="true"></i> </button>
                        </div>
                     </li>
                  </transition-group>
                  <h3 v-else class="empty-cart"> Vaša korpa je prazna. </h3>

                  <div class="bill">
                     <div class="price">
                        <h4> Cena </h4>
                        <h2> {{ Dollars(Total()) }} </h2>
                     </div>
                     <button :disabled="player.cart.length == 0" class="buy" v-on:click="Buy()"> <i class="fa fa-shopping-cart" aria-hidden="true"></i> </button>
                  </div>
               </div>
            </div>
         </div>

      </div>
          
      <!-- scripts -->
      <script src="src/vendor/js/vue.js"></script>
      <script>
         let market = new Vue({
            el: '#market',
            data: {
               player: {
                  money: 0,
                  cart: []
               },

               business: { 
                  name: 'Davis 24 / 7 Market', id: 1, multiplier: 0.3,
                  products: {
                     'Kanister': { icon: 'kanister', multiplier: 19 },
                     'awdawg Paaaaaaaaiva': { icon: 'pivo', multiplier: 3 },
                     'awdawdwa': { icon: 'kanister', multiplier: 19 },
                     'Flasa Piva': { icon: 'pivo', multiplier: 3 },
                     'Aaaa': { icon: 'kanister', multiplier: 19 },
                     'bbb Piva': { icon: 'pivo', multiplier: 3 },
                     'awda': { icon: 'kanister', multiplier: 19 },
                     'wadawd Piva': { icon: 'pivo', multiplier: 3 },
                     'awdawd': { icon: 'kanister', multiplier: 19 },
                     'awdawdfawg Piva': { icon: 'pivo', multiplier: 3 },
                     'awda': { icon: 'kanister', multiplier: 19 },
                     'f Piva': { icon: 'pivo', multiplier: 3 },
                     'fawdawd': { icon: 'kanister', multiplier: 19 }
                  },
               },
            },

            methods: { 
               Close: () => { mp.trigger('client:business.market:menu'); },

               Add: function (name, multiplier) { 
                  const Already = this.player.cart.find(item => item.name == name);
                  if (Already) Already.quantity ++;
                  else this.player.cart.push({ name: name, multiplier: multiplier, quantity: 1 });
               },

               Remove: function (item, index) {
                  item.quantity --;
                  if (item.quantity < 1) this.player.cart.splice(index, 1);
               },
               
               RemoveAll: function (index) {
                  this.player.cart.splice(index, 1);
               },

               Total: function () { 
                  let price = 0;
                  for (const item of this.player.cart) { 
                     price += (item.multiplier * this.business.multiplier) * item.quantity;
                  }
                  return price;
               },

               ItemsNumber: function () { 
                  let count = 0;
                  for (const item of this.player.cart) { 
                     count += 1 * item.quantity;
                  }
                  return count;
               },

               truncate: function (str, n) { return (str.length > n) ? str.substr(0, n-1) + '...' : str; },

               Dollars: (i) => {  return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(i); },

               Buy: function () { 
                  if (this.player.cart.length < 1) return;
                  const Price = this.Total(), Items = this.player.cart;
                  console.log(Price);
                  console.log(Items)
                  // mp.trigger('');
               }
               
            }
         })
      </script>
   </body>     
</html>
