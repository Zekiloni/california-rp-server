<!DOCTYPE html>
<html>
   <head>
      <!-- meta tags-->
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

      <!-- source -->
      <link rel="stylesheet" type="text/css" href="src/vendor/css/fonts.css" />
      <link rel="stylesheet" type="text/css" href="src/vendor/css/font-awesome.css" />

      <link rel="stylesheet" type="text/css" href="src/style.css" />

   </head>
   <body>

      <div id="inventory">
         <div class="ground"> </div>

         <div class="main">
            <div class="clothing">

            </div>

            <div class="inventory">
               <div class="header">
                  <h2> <i class="fa fa-list-alt" aria-hidden="true"> </i> Inventar </h2>
                  <h4> {{ Weight() }} <b>/ {{ player.maximum }} kg</b> </h4>
               </div>
               <div class="items">
                  <div class="item" v-for="(item, i) in player.items" v-if="item.entity == entity.Player" v-on:click="Use(item.id)" v-on:contextmenu="Menu($event, item.id)" v-on:mouseenter="audio.hover.play()">
                     <img :src="'src/images/items/' + item.hash + '.png'" :alt="item.id" /> 
                     <h3 class="quantity"> {{ item.quantity }} </h3>
                  </div>
               </div>
            </div>

            <div class="wheel">
               <div class="header">
                  <h2> <img src="src/icons/weapon.png" class="icon"> </i> Oru≈æije </h2>
                  <h4> {{ Weapons().length }} <b>/ {{ wheelMaximum.length }} </b> </h4>
               </div>
               <div class="weapons">
                   <div class="weapon" v-for="i in wheelMaximum">
                     <div class="inner" v-if="Weapons()[i]" v-on:click="Put(Weapons()[i])">
                        <img class="photo" :src="'src/images/items/' + Weapons()[i].hash + '.png'" />
                        <h3 class="ammo"> {{ Weapons()[i].ammo }} </h3>
                     </div>
                     <div class="inner" v-else>
                        <i class="george-floyd fa fa-times" aria-hidden="true"></i>
                     </div>
                  </div>
               </div>
            </div>
         </div>


         <transition name="bounce">
            <ul class="options" v-if="menu.item" v-bind:style="{ top: menu.top + 'px', left: menu.left + 'px' }" ref="menu" tabindex="-1" v-on:blur="CloseMenu()">
               <h4> {{ player.items.find(element => element.id === menu.item).name }} </h4>
               <li v-on:click="Drop(menu.item)"> Baci Predmet </li>
               <li> Daj Predmet </li>
            </ul>
         </transition>
      </div>

      <!-- scripts -->
      <script src="src/vendor/js/vue.js"> </script>
      <script>
         let inventory = new Vue({
            el: '#inventory',
            data: {
               player: {
                  money: null, 
                  maximum: 25,
                  items: [
                     { id: 3, name: 'Assault Rifle', quantity: 1, entity: 0, ammo: 0, weight: 0.25, hash: 'w_ar_assaultrifle' },
                     { id: 4, name: 'awdawd Rifle', quantity: 1, entity: 0, ammo: 0, weight: 0.25, hash: 'w_ar_assaultrifle' },
                     { id: 5, name: 'awdawd Rifle', quantity: 1, entity: 3, ammo: 0, weight: 0.25, hash: 'w_ar_assaultrifle' },
                     { id: 6, name: 'awdaww Rifle', quantity: 1, entity: 0, ammo: 0, weight: 0.25, hash: 'w_ar_assaultrifle' }
                  ], 

                  backpack: [
                     // TODO
                  ],
            
                  clothing: [1, 11, 8, 4, 6],
               },

               entity: { Player: 0, Wheel: 3 },

               menu: {
                  item: null,
                  top: 0,
                  left: 0
               },

               modal: null,
               selected: null,

               audio: {
                  hover: new Audio('src/sounds/hover.mp3')
               },

               wheelMaximum: [0, 1, 2, 3],
               clothingNames: ['hat', 'shirt', 'undershirt', 'bottoms', 'shoes']
            },

            methods: { 

               Menu: function (event, i) { 
                  this.menu.item = i;
                  this.menu.top = event.clientY - 5;
                  this.menu.left = event.clientX - 5;
                  
                  Vue.nextTick(function() { this.$refs.menu.focus(); }.bind(this));
                  event.preventDefault();
               },

               CloseMenu: function () { this.menu.item = null; },

               Weapons: function () { 
                  let list = [];
                  for (let item of this.player.items) { 
                     if (item.entity == this.entity.Wheel) list.push(item) 
                  }
                  console.log(list)
                  return list;
               },

               Weight: function () { 
                  let weight = 0;
                  this.player.items.forEach(item => { weight += (item.weight * item.quantity); });
                  return weight.toFixed(2);
               },

               Put: function (weapon) { 
                  // let index = this.player.items.indexOf(weapon);
                  weapon.entity = this.entity.Player;
                  // this.player.wheel.splice(index, 1);
                  // this.player.items.push(weapon);
                  mp.trigger('client:inventory.item.weapon:put', weapon.id)
               },


               Use: function (id) {
                  mp.trigger('client:inventory.item:use', id)
               },

               Drop: function (item) { 
                  this.menu.item = null;
                  item = this.player.items.find(element => element.id === item);
                  let index = this.player.items.indexOf(item);                        
                  this.player.items.splice(index, 1);
                  mp.trigger('client:inventory.item:drop', item.id, item.hash)
               }
            }
         })
         

         //window.addEventListener('contextmenu', e => e.preventDefault());


      </script>
   </body>     
</html>
