<!DOCTYPE html>
<html>
    <head>
        <!-- meta tags-->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- source -->
        <link rel="stylesheet" type="text/css" href="src/vendor/css/fonts.css" />
        <link rel="stylesheet" type="text/css" href="src/vendor/css/font-awesome.css" />

        <link rel="stylesheet" type="text/css" href="src/style.css" />

    </head>
    <body>

        <div class="ground"> </div>

        <div id="inventory">
            <div class="clothing">
                <div class="cloth" v-for="(item, key) in player.clothing" v-on:click="clothing(item)">
                    <img :src="'src/images/clothes/' + clothingNames[key] + '.png'">

                </div>
            </div>

            <!--  // v-if="player.items.length > 0" -->
            <div class="items">
                <div class="item" v-for="item in player.items" v-if="item" :key="item.id" v-on:click="use(item)" :data-id="item.id" >
                    <h2 class="name">{{ item.name }}</h2>
                    <img class="icon" :src="itemImage(item.hash)" />
                    <h4 class="quantity">{{ item.quantity }}</h4>
                </div>
            </div>

            <div class="weapons" >
                <div class="weapon" v-for="(weapon, key) in player.weapons" v-on:dblclick="weaponBack(weapon)"> 
                    <h2 v-on:click="weaponUse(key, weapon.id)"> {{ weapon.name }} {{ key }} </h2>
                    <h5>{{ weaponIndex(key) }}</h5>
                    <img :src="'src/images/' + key + '.png'">
                </div>
            </div>
        </div>
          
        <!-- scripts -->
        <script src="src/vendor/js/jquery-3.5.1.js"></script>
        <script src="src/vendor/js/jquery-ui.min.js"></script>
        <script src="src/vendor/js/vue.js"></script>
        <script>
            var inventory = new Vue({
                el: '#inventory',
                data: {
                    player: {
                        money: null, weapons: [], items: null, // { id: 0, name: 'Zeki gej'}, { id: 0, name: 'Mare gej'}
                        clothing: [1, 11, 8, 4, 6],
                    },

                    clothingNames: ['hat', 'shirt', 'undershirt', 'bottoms', 'shoes']
                },

                methods: { 

                    load: function (items) { 
                        this.player.items = items;
                        console.log(JSON.stringify(items))
                    },

                    weaponUse: function (i, w) { 
                        mp.trigger('client:inventory.weapon.select', i, w)
                    },

                    weaponBack: function (weapon) { 
                        weapon = this.player.weapons.find(element => element === weapon);
                        let index = this.player.weapons.indexOf(weapon);          
                        this.player.weapons.splice(index, 1);
                        mp.trigger('client:inventory.process.item', 'put', weapon.id)
                    },

                    clothing: function (index) {
                        mp.trigger('client:inventory.process.clothing', index)
                    },

                    weaponIndex: (i) => { 
                        let names = ['Primarno Oružije', 'Sekundardno oružije'];
                        return names[i];
                    },

                    use: function (item) {
                        item = this.player.items.find(element => element === item);
                        let index = this.player.items.indexOf(item);                        
                        this.player.items.splice(index, 1);
                        mp.trigger('client:inventory.process.item', 'use', item.id)
                    },

                    drop: function (item) { 
                        item = this.player.items.find(element => element === item);
                        let index = this.player.items.indexOf(item);                        
                        this.player.items.splice(index, 1);
                        mp.trigger('client:inventory.process.item', 'drop', item.id)
                    },

                    itemImage: (hash) => { 
                        let source = 'src/images/items/' + hash + '.png'; 
                        return source;
                    }
                }
            })

            setTimeout(() => {
                $('.item').draggable({ revert: true });

                $(".ground").droppable({
                    accept: '.item',
                    drop: function(event, ui) {
                        let item = inventory.player.items.find(element => element.id === parseInt(ui.draggable[0].attributes[0].value))
                        inventory.drop(item)
                        $(".item").draggable({ revert: true });
                    }
                });
            }, 1000);

        </script>
    </body>     
</html>
