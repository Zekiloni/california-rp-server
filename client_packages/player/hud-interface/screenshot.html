<!DOCTYPE html>
<html>
<head>
    <title>Screenshot to Server Zeky</title>
</head>
<body>
    <script src="src/vendor/js/jquery-3.2.1.js"></script>

<script>
    mp.events.add("client:screenshot.receive", (imgURL) => {
        var img = new Image();
        img.crossOrigin = 'Anonymous';
        img.src = imgURL;
        img.onload = (() => {
            var canvas = document.createElement("canvas");
            canvas.width = this.innerWidth;
            canvas.height = this.innerHeight;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            var dataURL = canvas.toDataURL("image/png");
            let bs64 = dataURL.replace('data:image/png;base64,', '');
            //console.log(dataURL)
            var settings = {
                "url": "https://api.imgbb.com/1/upload",
                "method": "POST",
                "timeout": 0,
                "headers": {
                    "Content-Type": "application/x-www-form-urlencoded"
            },
                "data": {
                    "key": "ab6b6da146bfb16e3417e6e73ffd8d95", 
                    "image" : bs64
                }
            }
            $.ajax(settings).done(function (response) {
                var respond = JSON.stringify(response)
                mp.trigger('client:screenshot.send.to.server', respond);
            });
            
        }); 
    })

</script>
</body>
</html>
