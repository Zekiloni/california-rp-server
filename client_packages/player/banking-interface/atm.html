<!DOCTYPE html>
<html>
    <head>
        <!-- meta tags-->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- source -->
        <link rel="stylesheet" type="text/css" href="src/vendor/css/fonts.css" />
        <link rel="stylesheet" type="text/css" href="src/vendor/css/font-awesome.css" />

        <link rel="stylesheet" type="text/css" href="src/style.css" />

    </head>
    <body>
        <div id="atm" v-bind:class="{ logged: logged }">
            <div class="header" >
                <div class="logo-holder">
                    <img v-bind:src="'src/images/' + bank + '-logo.png'" /> 
                </div>
            </div>

            <div v-if="!logged" class="authorization">
                <div class="digits">
                    <h4 class="welcome">Molimo prijavite se !</h4>
                    <h3 class="pin-input"> {{ pin }} </h3>
                    <h4 class="digit" v-for="digit in digits" @click="input(digit)"> {{ digit }} </h4>
                    <h4 class="cc" @click="input(-1)"> <i class="fa fa-times" aria-hidden="true"></i> </h4>
                </div>
                <button class="login" @click="login()"> Prijava </button>
            </div>

            <div v-if="logged" class="dashboard">
                <i @click="close()" class="close fa fa-times" aria-hidden="true"></i>

                

                <div class="account">
                    <div class="profile">
                        <h2> {{ player.name }} </h2>
                        <small> broj računa <b> {{ AccountNumber() }} </b></small>
                        <h2 class="balance"> {{ format(player.balance) }} </h2>
                    </div>

                    <ul class="navigation">
                        <li @click="page = 'home'" :class="{ active:page === 'home' }"> 
                            <h3>Početna</h3>
                            <i class="fa fa-home" aria-hidden="true"></i>
                        </li>
                        <li @click="page = 'withdraw'" :class="{ active:page === 'withdraw' }"> 
                            <h3>Podizanje Novca</h3>
                            <i class="far fa-credit-card"></i>
                        </li>
                        <li @click="page = 'deposit'" :class="{ active:page === 'deposit' }"> 
                            <h3>Ostavljanje Novca</h3>
                            <i class="icon far fa-money-bill-alt"></i>                        
                        </li>
                        <li @click="page = 'transfer'" :class="{ active:page === 'transfer' }"> 
                            <h3>Transfer Novca</h3>
                            <i class="fas fa-exchange-alt"></i>
                        </li>
                    </ul>
                </div>

                <div class="page">
                    <div class="home-page" v-if="page == 'home'">
                        <ul class="informations">
                            <li>
                                <h3>Plata</h3>
                                <h3>{{ format(player.paycheck) }}</h3>
                                <button class="cash-me-outside" :disabled="player.paycheck < 100" @click="payout(player.paycheck)">isplati</button>
                            </li>

                            <li>
                                <h3>Štedni Račun</h3>
                                <h3>{{ format(player.savings) }}</h3>
                                <button class="cash-me-outside" :disabled="player.paycheck < 1000" @click="savings('take')"><i class="fa fa-arrow-up" aria-hidden="true"></i></button>
                                <button class="cash-me-outside" :disabled="player.paycheck < 1000" @click="savings('put')"><i class="fa fa-arrow-down" aria-hidden="true"></i></button>

                            </li>
                            <li></li>
                       </ul>
                    </div>

                    <div class="home-page" v-if="page == 'withdraw'">
                        <h3 class="page-title">Podizanje Novca sa računa</h3>
                        <div class="withdraw-handler">
                            <input type="number" v-model="values.withdraw">
                            <button :disabled="values.withdraw == 0 || values.withdraw > player.balance" class="withdraw" @click="withdraw(values.withdraw)">
                                <i class="fas fa-dollar-sign"></i>
                            </button>
                        </div>
                    </div>

                    <div class="home-page" v-if="page == 'deposit'">
                        <h3 class="page-title">Ostavljanje Novca sa računa</h3>
                        <div class="deposit-handler">
                            <input type="number" v-model="values.deposit">
                            <button :disabled="values.deposit == 0 || values.deposit > player.money" class="deposit" @click="deposit(values.deposit)">
                                <i class="fas fa-dollar-sign"></i>
                            </button>
                        </div>               
                    </div>

                    <div class="home-page" v-if="page == 'transfer'">
                        transfer page
                    </div>

                    <div v-if="notification" class="notification"> {{ notification }} </div>

                </div>
            </div>
        </div>
          
        <!-- scripts -->
        <script src="src/vendor/js/vue.js"></script>
        <script>

            let atm = new Vue({
                el: '#atm',
                data: {
                    bank: 'fleeca',

                    player: {
                        name: 'Zachary Parker',
                        money: 0, balance: 0,
                        savings: 0, number: 0,
                        paycheck: 0,
                        pin: 0
                    },

                    digits: [ 0, 1, 2, 3, 4, 5, 6, 7, 8 ],
                    loginAttempts: 0,
                    pin: '',
                    logged: false,
                    page: 'home',

                    notification: null,

                    values: {
                        withdraw: 0,
                        deposit: 0,
                        transfer: 0,
                    },

                    audio: {
                        ka_ching: new Audio('src/ka-ching.mp3')
                    }

                },

                methods: { 
                    close: () => { mp.trigger('client:player.banking'); },

                    format: function (i) { 
                        let formatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' });
                        return formatter.format(i);
                    },

                    payout: function (i) {
                        this.audio.ka_ching.play();
                        let value = this.player.paycheck;
                        this.player.paycheck = 0;
                        this.player.balance += value;
                        this.notify('Uspešno ste se prebacili sa platnog računa na bankovni ' + value + '$.')
                        mp.trigger('client:player.banking.payout', value);
                    },  

                    AccountNumber: function () { 
                        let i = JSON.stringify(this.player.number).match(/.{1,4}/g);
                        return i.join(' ');
                    },

                    input: function (i) { 
                        let audio = new Audio('src/click.mp3'); audio.play();
                        if (i == -1) { this.pin = this.pin.slice(0, -1); } 
                        else { if (this.pin.length >= 4) return; this.pin += i; }
                    },

                    notify: function (m) { 
                        this.notification = m;
                        setTimeout(() => { this.notification = null; }, 1 * 5000);
                    },

                    login: function () { 
                        if (this.pin.length == 4) { 
                            if (this.player.pin == this.pin) { 
                                let audio = new Audio('src/success.mp3'); audio.play();
                                this.logged = true;
                            } else { 
                                let audio = new Audio('src/error.mp3'); audio.play();
                                this.loginAttempts ++;
                                this.pin = '';
                                if (this.loginAttempts > 3) { 
                                    this.close();
                                }
                            }
                        }
                    },

                    withdraw: function (value) {
                        if (this.player.balance >= value) {
                            this.values.withdraw = 0;
                            this.player.balance -= value;
                            this.audio.ka_ching.play();
                            mp.trigger('client:player.banking.withdraw', this.player.number, value);
                            // podigni
                        } else { 
                            // error
                        }
                    },

                    deposit: function (value) { 
                        if (value <= this.player.money) {
                            this.values.deposit = 0;
                            this.player.money -= value;
                            this.player.balance += parseInt(value);
                            this.audio.ka_ching.play();
                            mp.trigger('client:player.banking.deposit', this.player.number, value);
                        } else { 
                            // error
                        }
                    },

                    transfer: function (target, value) { 
                        if (value <= this.player.balance) { 
                            // do transfer
                        } else { 
                            // error
                        }
                    }
                }
            })
        </script>
    </body>     
</html>
