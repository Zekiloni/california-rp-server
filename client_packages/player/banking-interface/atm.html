<!DOCTYPE html>
<html>
    <head>
        <!-- meta tags-->
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- source -->
        <link rel="stylesheet" type="text/css" href="src/vendor/css/fonts.css" />
        <link rel="stylesheet" type="text/css" href="src/vendor/css/font-awesome.css" />

        <link rel="stylesheet" type="text/css" href="src/style.css" />

    </head>
    <body>
        <div id="atm" v-bind:class="{ logged: logged }">
            <div class="header" >
                <div class="logo-holder">
                    <img v-bind:src="'src/images/' + bank + '-logo.png'" /> 
                </div>
            </div>

            <div v-if="!logged" class="authorization">
                <div class="digits">
                    <h4 class="welcome">Molimo prijavite se !</h4>
                    <h3 class="pin-input"> {{ pin }} </h3>
                    <h4 class="digit" v-for="digit in digits" @click="input(digit)"> {{ digit }} </h4>
                    <h4 class="cc" @click="input(-1)"> <i class="fa fa-times" aria-hidden="true"></i> </h4>
                </div>
                <button class="login" @click="login()"> Prijava </button>
            </div>

            <div v-if="logged">
                <i @click="close()" class="close fa fa-times" aria-hidden="true"></i>

            </div>

           
        </div>
          
        <!-- scripts -->
        <script src="src/vendor/js/vue.js"></script>
        <script>

            let atm = new Vue({
                el: '#atm',
                data: {
                    bank: 'fleeca',

                    player: {
                        name: null,
                        money: 0,
                        balance: 0,
                        savings: 0,
                        number: 0,
                        paycheck: 0,
                        pin: 0
                    },

                    digits: [ 0, 1, 2, 3, 4, 5, 6, 7, 8 ],
                    loginAttempts: 0,
                    pin: '',
                    logged: false,


                },

                methods: { 
                    close: () => { mp.trigger('client:player.banking'); },

                    input: function (i) { 
                        let audio = new Audio('src/click.mp3'); audio.play();
                        if (i == -1) { this.pin = this.pin.slice(0, -1); } 
                        else { if (this.pin.length >= 4) return; this.pin += i; }
                    },

                    login: function () { 
                        if (this.pin.length == 4) { 
                            if (this.player.pin == this.pin) { 
                                let audio = new Audio('src/success.mp3'); audio.play();
                                this.logged = true;
                            } else { 
                                let audio = new Audio('src/error.mp3'); audio.play();
                                this.loginAttempts ++;
                                this.pin = '';
                                if (this.loginAttempts > 3) { 
                                    this.close();
                                }
                            }
                        }
                    },

                    withdraw: function (value) {
                        if (this.player.balance >= value) {
                            mp.trigger('client:player.banking.withdraw', value);
                            // podigni
                        } else { 
                            // error
                        }
                    },

                    deposit: function (value) { 
                        if (value <= this.player.money) {
                            // ostavi pare
                        } else { 
                            // error
                        }
                    },

                    transfer: function (target, value) { 
                        if (value <= this.player.balance) { 
                            // do transfer
                        } else { 
                            // error
                        }
                    }
                }
            })
        </script>
    </body>     
</html>
